# Jamakers v0.3.0  Release date: 2025-10-18  ## Highlights - Drizzle-backed DbStorage for core entities (Users, Brands, Loan Applications) - Dynamic storage selection: database when `DATABASE_URL` is set, otherwise in-memory - Postgres pool/TLS tuning and conditional SSL enablement - ESM-compatible `pg` import fix in `server/db.ts` - Drizzle migrations generated and `pgcrypto` extension enabled  ## Changes - Add `server/dbStorage.ts` implementing Drizzle ORM methods for Users, Brands, and Loan Applications, with lazy `db` import to avoid env coupling in dev. - Update `server/storage.ts` to prefer DbStorage when `process.env.DATABASE_URL` is present; fallback to MemoryStorage otherwise. - Improve `server/db.ts`:   - Use `import pg from 'pg'; const { Pool } = pg` for Node ESM compatibility   - Conditional SSL: enabled if `DATABASE_SSL_CA` provided, `PG_SSL=true` or `DATABASE_SSL=true`, or `sslmode=require|verify-*` in `DATABASE_URL`   - Pool tuning defaults: `max=10`, `idleTimeoutMillis=30000`, `connectionTimeoutMillis=5000`   - Correctly parse CA PEM with escaped `\n` - Migrations:   - `migrations/0000_flimsy_ghost_rider.sql`: autogenerated schema snapshot   - `migrations/0001_enable_pgcrypto.sql`: `CREATE EXTENSION IF NOT EXISTS pgcrypto;`  ## Deployment Notes - Set `DATABASE_URL` to your Postgres connection string. - If your DB requires SSL:   - Set `PG_SSL=true` or include `sslmode=require` in `DATABASE_URL`   - Optionally set `DATABASE_SSL_CA` with your PEM content (use `\n` for newlines in env) - Apply migrations:   - `npm run db:push` (or `npx drizzle-kit push`) with `DATABASE_URL` configured  ## Breaking Changes - None expected. `getStorage()` gracefully falls back to in-memory when no DB is configured.  ## Known Issues - Invalid DB credentials or connectivity will surface during server startup when DbStorage is active. - Windows inline env usage in `npm run dev` may fail; use PowerShell env assignment or `npx tsx server/index.ts`.  ## Acknowledgments - Introduces a safe path to migrate more entities to Drizzle over time while retaining full local dev without DB. 

Deployment guide:  https://github.com/ascentdesign/Jamakers/blob/main/docs/DEPLOYING_v0.3.0.md